{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nimport { ethers } from 'ethers';\nimport FlashLoanABI from '../contracts/FlashLoan.json';\nimport DexAMMABI from '../contracts/DexAMM.json';\nimport { FLASH_LOAN_ADDRESS } from '../utils/constants';\nexport function useContracts(signer, provider) {\n  _s();\n  const [flashLoanContract, setFlashLoanContract] = useState(null);\n  const [dexAContract, setDexAContract] = useState(null);\n  const [dexBContract, setDexBContract] = useState(null);\n  const [dexAAddress, setDexAAddress] = useState('');\n  const [dexBAddress, setDexBAddress] = useState('');\n  const [ammInfo, setAmmInfo] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  // Initialize contracts\n  useEffect(() => {\n    if (!signer) {\n      setFlashLoanContract(null);\n      setDexAContract(null);\n      setDexBContract(null);\n      return;\n    }\n    const initContracts = async () => {\n      try {\n        const flashLoan = new ethers.Contract(FLASH_LOAN_ADDRESS, FlashLoanABI, signer);\n        setFlashLoanContract(flashLoan);\n\n        // Get DEX addresses from FlashLoan contract\n        const dexA = await flashLoan.dexA();\n        const dexB = await flashLoan.dexB();\n        setDexAAddress(dexA);\n        setDexBAddress(dexB);\n\n        // Initialize DEX contracts\n        const dexAInstance = new ethers.Contract(dexA, DexAMMABI, signer);\n        const dexBInstance = new ethers.Contract(dexB, DexAMMABI, signer);\n        setDexAContract(dexAInstance);\n        setDexBContract(dexBInstance);\n      } catch (err) {\n        console.error('Error initializing contracts:', err);\n        setError(err.message || 'Failed to initialize contracts');\n      }\n    };\n    initContracts();\n  }, [signer]);\n\n  // Fetch AMM info\n  const fetchAMMInfo = useCallback(async () => {\n    if (!flashLoanContract || !dexAContract || !dexBContract) return;\n    setIsLoading(true);\n    setError('');\n    try {\n      // Fetch all data in parallel\n      const [priceA, priceB, daiBalanceA, wethBalanceA, daiBalanceB, wethBalanceB] = await Promise.all([dexAContract.getPrice(), dexBContract.getPrice(), dexAContract.getDAIBalance(), dexAContract.getWETHBalance(), dexBContract.getDAIBalance(), dexBContract.getWETHBalance()]);\n      const dexA = {\n        address: dexAAddress,\n        name: 'DEX A',\n        price: priceA,\n        daiBalance: daiBalanceA,\n        wethBalance: wethBalanceA\n      };\n      const dexB = {\n        address: dexBAddress,\n        name: 'DEX B',\n        price: priceB,\n        daiBalance: daiBalanceB,\n        wethBalance: wethBalanceB\n      };\n\n      // Calculate price difference percentage\n      const numA = Number(priceA);\n      const numB = Number(priceB);\n      const diff = Math.abs(numA - numB);\n      const avg = (numA + numB) / 2;\n      const priceDifference = avg > 0 ? diff / avg * 100 : 0;\n\n      // Profitable if price difference > 0.6% (covers 2x 0.3% AMM fees)\n      const isProfitable = priceDifference > 0.6;\n      setAmmInfo({\n        dexA,\n        dexB,\n        priceDifference,\n        isProfitable\n      });\n    } catch (err) {\n      console.error('Error fetching AMM info:', err);\n      setError(err.message || 'Failed to fetch AMM info');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [flashLoanContract, dexAContract, dexBContract, dexAAddress, dexBAddress]);\n\n  // Auto-refresh AMM info\n  useEffect(() => {\n    if (!flashLoanContract || !dexAContract || !dexBContract) return;\n    fetchAMMInfo();\n    const interval = setInterval(fetchAMMInfo, 10000); // Refresh every 10 seconds\n    return () => clearInterval(interval);\n  }, [flashLoanContract, dexAContract, dexBContract, fetchAMMInfo]);\n  return {\n    flashLoanContract,\n    dexAContract,\n    dexBContract,\n    dexAAddress,\n    dexBAddress,\n    ammInfo,\n    isLoading,\n    error,\n    refreshAMMInfo: fetchAMMInfo\n  };\n}\n_s(useContracts, \"8YaefileqqJ/mveCq/Lgn5iR8CU=\");","map":{"version":3,"names":["useState","useEffect","useCallback","ethers","FlashLoanABI","DexAMMABI","FLASH_LOAN_ADDRESS","useContracts","signer","provider","_s","flashLoanContract","setFlashLoanContract","dexAContract","setDexAContract","dexBContract","setDexBContract","dexAAddress","setDexAAddress","dexBAddress","setDexBAddress","ammInfo","setAmmInfo","isLoading","setIsLoading","error","setError","initContracts","flashLoan","Contract","dexA","dexB","dexAInstance","dexBInstance","err","console","message","fetchAMMInfo","priceA","priceB","daiBalanceA","wethBalanceA","daiBalanceB","wethBalanceB","Promise","all","getPrice","getDAIBalance","getWETHBalance","address","name","price","daiBalance","wethBalance","numA","Number","numB","diff","Math","abs","avg","priceDifference","isProfitable","interval","setInterval","clearInterval","refreshAMMInfo"],"sources":["C:/Users/Leo/OneDrive/Documentos/Faculdade INSA/Blockchain/project/flash-loan-project/frontend/src/hooks/useContracts.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { ethers } from 'ethers';\r\nimport FlashLoanABI from '../contracts/FlashLoan.json';\r\nimport DexAMMABI from '../contracts/DexAMM.json';\r\nimport { FLASH_LOAN_ADDRESS } from '../utils/constants';\r\nimport { AMMInfo, DexInfo } from '../types';\r\n\r\nexport function useContracts(signer: ethers.Signer | null, provider: ethers.BrowserProvider | null) {\r\n  const [flashLoanContract, setFlashLoanContract] = useState<ethers.Contract | null>(null);\r\n  const [dexAContract, setDexAContract] = useState<ethers.Contract | null>(null);\r\n  const [dexBContract, setDexBContract] = useState<ethers.Contract | null>(null);\r\n  const [dexAAddress, setDexAAddress] = useState<string>('');\r\n  const [dexBAddress, setDexBAddress] = useState<string>('');\r\n  const [ammInfo, setAmmInfo] = useState<AMMInfo | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string>('');\r\n\r\n  // Initialize contracts\r\n  useEffect(() => {\r\n    if (!signer) {\r\n      setFlashLoanContract(null);\r\n      setDexAContract(null);\r\n      setDexBContract(null);\r\n      return;\r\n    }\r\n\r\n    const initContracts = async () => {\r\n      try {\r\n        const flashLoan = new ethers.Contract(\r\n          FLASH_LOAN_ADDRESS,\r\n          FlashLoanABI,\r\n          signer\r\n        );\r\n        setFlashLoanContract(flashLoan);\r\n\r\n        // Get DEX addresses from FlashLoan contract\r\n        const dexA = await flashLoan.dexA();\r\n        const dexB = await flashLoan.dexB();\r\n\r\n        setDexAAddress(dexA);\r\n        setDexBAddress(dexB);\r\n\r\n        // Initialize DEX contracts\r\n        const dexAInstance = new ethers.Contract(dexA, DexAMMABI, signer);\r\n        const dexBInstance = new ethers.Contract(dexB, DexAMMABI, signer);\r\n\r\n        setDexAContract(dexAInstance);\r\n        setDexBContract(dexBInstance);\r\n      } catch (err: any) {\r\n        console.error('Error initializing contracts:', err);\r\n        setError(err.message || 'Failed to initialize contracts');\r\n      }\r\n    };\r\n\r\n    initContracts();\r\n  }, [signer]);\r\n\r\n  // Fetch AMM info\r\n  const fetchAMMInfo = useCallback(async () => {\r\n    if (!flashLoanContract || !dexAContract || !dexBContract) return;\r\n\r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      // Fetch all data in parallel\r\n      const [\r\n        priceA,\r\n        priceB,\r\n        daiBalanceA,\r\n        wethBalanceA,\r\n        daiBalanceB,\r\n        wethBalanceB,\r\n      ] = await Promise.all([\r\n        dexAContract.getPrice(),\r\n        dexBContract.getPrice(),\r\n        dexAContract.getDAIBalance(),\r\n        dexAContract.getWETHBalance(),\r\n        dexBContract.getDAIBalance(),\r\n        dexBContract.getWETHBalance(),\r\n      ]);\r\n\r\n      const dexA: DexInfo = {\r\n        address: dexAAddress,\r\n        name: 'DEX A',\r\n        price: priceA,\r\n        daiBalance: daiBalanceA,\r\n        wethBalance: wethBalanceA,\r\n      };\r\n\r\n      const dexB: DexInfo = {\r\n        address: dexBAddress,\r\n        name: 'DEX B',\r\n        price: priceB,\r\n        daiBalance: daiBalanceB,\r\n        wethBalance: wethBalanceB,\r\n      };\r\n\r\n      // Calculate price difference percentage\r\n      const numA = Number(priceA);\r\n      const numB = Number(priceB);\r\n      const diff = Math.abs(numA - numB);\r\n      const avg = (numA + numB) / 2;\r\n      const priceDifference = avg > 0 ? (diff / avg) * 100 : 0;\r\n\r\n      // Profitable if price difference > 0.6% (covers 2x 0.3% AMM fees)\r\n      const isProfitable = priceDifference > 0.6;\r\n\r\n      setAmmInfo({\r\n        dexA,\r\n        dexB,\r\n        priceDifference,\r\n        isProfitable,\r\n      });\r\n    } catch (err: any) {\r\n      console.error('Error fetching AMM info:', err);\r\n      setError(err.message || 'Failed to fetch AMM info');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [flashLoanContract, dexAContract, dexBContract, dexAAddress, dexBAddress]);\r\n\r\n  // Auto-refresh AMM info\r\n  useEffect(() => {\r\n    if (!flashLoanContract || !dexAContract || !dexBContract) return;\r\n\r\n    fetchAMMInfo();\r\n\r\n    const interval = setInterval(fetchAMMInfo, 10000); // Refresh every 10 seconds\r\n    return () => clearInterval(interval);\r\n  }, [flashLoanContract, dexAContract, dexBContract, fetchAMMInfo]);\r\n\r\n  return {\r\n    flashLoanContract,\r\n    dexAContract,\r\n    dexBContract,\r\n    dexAAddress,\r\n    dexBAddress,\r\n    ammInfo,\r\n    isLoading,\r\n    error,\r\n    refreshAMMInfo: fetchAMMInfo,\r\n  };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}